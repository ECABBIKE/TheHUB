# TheHUB Security Configuration

# Deny access to .env files
<FilesMatch "^\.env">
    Order allow,deny
    Deny from all
</FilesMatch>

# Deny access to git files
<FilesMatch "^\.git">
    Order allow,deny
    Deny from all
</FilesMatch>

# Deny access to composer files
<FilesMatch "composer\.(json|lock)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Deny access to package manager files
<FilesMatch "(package\.json|package-lock\.json|yarn\.lock)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Enable rewrite engine
RewriteEngine On

# Redirect to HTTPS (enabled for production)
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Prevent directory listing
Options -Indexes

# ============================================================================
# CLEAN URL ROUTING - URLs without .php extensions
# ============================================================================

# Skip rewriting for actual files (CSS, JS, images, etc.)
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

# Skip rewriting for directories (except specific ones we want to route)
RewriteCond %{REQUEST_FILENAME} -d
RewriteCond %{REQUEST_URI} !^/(ranking|clubs)/?$
RewriteRule ^ - [L]

# Skip admin folder - let it handle its own routing
RewriteRule ^admin(/.*)?$ - [L]

# Skip API endpoints
RewriteRule ^api(/.*)?$ - [L]

# Skip V3 folder - it has its own router
RewriteRule ^v3(/.*)?$ - [L]

# Skip legacy .php files that are accessed directly (for backwards compatibility)
RewriteCond %{REQUEST_URI} \.(php|html|htm)$
RewriteRule ^ - [L]

# ============================================================================
# Direct rewrites to legacy PHP files (simple, no SPA overhead)
# ============================================================================

# Home
RewriteRule ^home/?$ index.php [L]

# Calendar/Events
RewriteRule ^calendar/?$ events.php [L,QSA]
RewriteRule ^calendar/([0-9]+)/?$ event.php?id=$1 [L,QSA]
RewriteRule ^events/?$ events.php [L,QSA]

# Results
RewriteRule ^results/?$ results.php [L,QSA]
RewriteRule ^results/([0-9]+)/?$ event-results.php?id=$1 [L,QSA]

# Series
RewriteRule ^series/?$ series.php [L,QSA]
RewriteRule ^series/([0-9]+)/?$ series-standings.php?id=$1 [L,QSA]

# Riders/Database
RewriteRule ^riders/?$ riders.php [L,QSA]
RewriteRule ^rider/([0-9]+)/?$ rider.php?id=$1 [L,QSA]
RewriteRule ^database/?$ riders.php [L,QSA]

# Clubs
RewriteRule ^clubs/?$ clubs/leaderboard.php [L,QSA]
RewriteRule ^club/([0-9]+)/?$ club.php?id=$1 [L,QSA]

# Ranking
RewriteRule ^ranking/?$ ranking/index.php [L,QSA]

# Profile
RewriteRule ^profile/?$ profile.php [L,QSA]
RewriteRule ^profile/login/?$ rider-login.php [L,QSA]
RewriteRule ^profile/register/?$ rider-register.php [L,QSA]

# Event (alias for results)
RewriteRule ^event/([0-9]+)/?$ event-results.php?id=$1 [L,QSA]

# Custom error pages
ErrorDocument 404 /404.php
